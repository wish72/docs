# Перенос сайта WordPress

Эта инструкция поможет вам быстро перенести в {{ yandex-cloud }} веб-сайт, работающий под управлением WordPress.

**WordPress** - система управления сайтом (Content Management System, сокращённо **CMS**), использующая стек (набор) технологий, часто обозначаемый аббревиатурой **LAMP**:

- операционная система Linux;
- веб-сервер Apache;
- система управления базами данных (СУБД) MySQL (или её современный свободный аналог MariaDB);
- система программирования PHP.

Стек LAMP широко используется, и поэтому {{ yandex-cloud }} предлагает заранее подготовленный образ виртуальной машины для запуска приложений, использующих этот стек.

Чтобы перенести существующий веб-сайт WordPress:

1. [Подготовьте облако к работе](#before-you-begin).
1. [Создайте виртуальную машину с предустановленным стеком LAMP](#create-vm).
1. [Экспортируйте существующий сайт](#export-wp-data).
1. [Импортируйте сайт на виртуальную машину](#import-wp-data).
1. [Проверьте работу сайта](#test-site).
1. [Настройте DNS](#configure-dns).
1. [Настройте доступ по защищённому протоколу HTTPS](#setup-https).

Если перенесённый вами веб-сайт вам больше не нужен, [удалите все используемые им ресурсы](#clear-out).

## Подготовьте облако к работе {#before-you-begin}

Чтобы запустить веб-сайт в {{ yandex-cloud }}, нужно создать виртуальную машину (ВМ), в которой будут храниться данные сайта, будет работать веб-сервер и другое программное обеспечение, необходимое для работы сайта. Но прежде нужно зарегистрироваться в {{ yandex-cloud }} и создать платежный аккаунт:

{% include [prepare-register-billing](../_solutions_includes/prepare-register-billing.md) %}

{{ yandex-cloud }} позволяет управлять большим количеством виртуальных машин и других ресурсов, например, виртуальных дисков. Для удобства управления их объединяют в группы, которые называются каталогами. Все каталоги, принадлежащие пользователю, вместе образуют личное облако ресурсов пользователя.

Чтобы создать виртуальную машину, нужно выбрать существующий или создать новый каталог для её размещения на [странице облака](https://console.cloud.yandex.ru/cloud). Если у вас только одна виртуальная машина, поместите её в каталог ресурсов по умолчанию, который называется `default`.

[Подробнее об облаках и каталогах](../../resource-manager/concepts/resources-hierarchy.md).

### Необходимые платные ресурсы {#paid-resources}

В стоимость поддержки веб-сайта на WordPress, как и для других сервисов на стеке LAMP, входит следующее:

* плата за постоянно запущенную виртуальную машину (см. [тарифы {{ compute-full-name }}](../../compute/pricing.md));
* плата за использование динамического или статического внешнего IP-адреса (см. [тарифы {{ vpc-full-name }}](../../vpc/pricing.md)).

## Создайте виртуальную машину с предустановленным стеком LAMP {#create-vm}

{% note tip %}

Выбирая параметры вашей будущей виртуальной машины, вы сразу будете видеть расчёт её стоимости. Воспользуйтесь этим расчётом, чтобы выбрать параметры, соответствующие бюджету вашего проекта.

{% endnote %}

Чтобы создать виртуальную машину:

1. На странице выбранного вами каталога ресурсов в [консоли управления]({{ link-console-main }}) нажмите кнопку **Создать ресурс** и выберите пункт **Виртуальная машина**.

1. В поле **Имя** введите имя виртуальной машины. Пример: `wordpress-vm`.

    {% include [name-format](../../_includes/name-format.md) %}

1. Выбор [зоны доступности](../../overview/concepts/geo-scope.md) определяет, где территориально будут находиться физические серверы, на которых будет работать ваша ВМ. Если вам это не важно, оставьте значение по умолчанию.

1. В разделе **Выбор образа/загрузочного диска** выберите вкладку  **{{ marketplace-name }}**, нажмите кнопку **Посмотреть больше** и выберите образ виртуальной машины **LAMP**.

1. В разделе **Диски** укажите тип (HDD или SSD) и размер диска виртуальной машины.

   - Диски SSD большую часть операций производят значительно быстрее, однако пользование дисками HDD заметно дешевле. Наилучший выбор зависит от того, какие данные и в каком объеме хранятся на вашем сайте и какая стоимость для вас приемлема. При необходимости, можно настроить ВМ с двумя или большим числом дисков разных типов.

   - Выбирая размер диска, учитывайте, что примерно 3-5 ГБ дискового пространства будет занято операционной системой и служебными файлами. Оцените примерный объем файлов вашего существующего сайта. Учтите, что для упрощения импорта сайта вам предстоит скопировать на виртуальную машину архив файлов сайта, а затем распаковать этот архив, что может потребовать дисковое пространство вдвое большее, чем занимают файлы сайта.

   - Размер диска ВМ в дальнейшем можно будет без особого труда увеличить, поэтому нет смысла делать диск чрезмерно большим. Уменьшить размер диска будет нельзя.

1. В разделе **Вычислительные ресурсы**:

    - Выберите [платформу](../../compute/concepts/vm-platforms.md) виртуальной машины.
    - Укажите необходимое количество vCPU (виртуальных процессоров) и объем RAM.
    - Если вы создаёте ВМ для тестирования, может быть полезно отметить флажок **Прерываемая**.

    _Прерываемая_ ВМ дешевле, но работа такой ВМ через 24 часа после запуска будет автоматически останавливаться. Более того, её работа может быть остановлена Облаком в любое время. Для возобновления работы ВМ потребуется запустить её заново. Прерывание работы ВМ не вызывает удаления её данных.

   Минимальный рекомендованный объем ресурсов для несложного сайта WordPress:

   Платформа | Гарантированная доля vCPU | vCPU | RAM
   --- | :---: | :---: | :---:
   Intel Cascade Lake | 20% | 2 | 1 ГБ

   Вычислительные ресурсы, предоставляемые виртуальной машине, можно будет в дальнейшем менять.

1. В разделе **Сетевые настройки** нужно выбрать сеть и подсеть, к которым нужно подключить виртуальную машину. Если у вас много облачных ресурсов, вам, возможно, потребуется распределить их по разным виртуальным подсетям для фильтрации сетевого трафика по соображениям безопасности, для изоляции неполадок и т.п. Если вам пока не нужны сети и подсети, оставьте значения по умолчанию.

1. Выберите значение в поле **Публичный адрес**:

   - Если вы создаёте ВМ для тестирования, можно оставить значение **Автоматически**. В этом случае публичный адрес машине будет назначен в момент её запуска, притом этот адрес может измениться после остановки и повторного запуска машины, в том числе из-за её прерывания, если машина прерываемая. Адрес не будет изменяться при штатной перезагрузке машины. Для постоянно действующего веб-сайта такой адрес, называемый _динамическим_, неудобен, т.к. после каждой замены адреса придётся заново вносить его в систему имён DNS, и это будет сопровождаться временной недоступностью сайта. Однако, динамический адрес после настройки и тестирования ВМ можно преобразовать в статический, и в этом случае он будет зарезервирован за вашим облаком постоянно.

   - Значение **Список** наилучшим образом подходит для постоянно действующего веб-сайта. При выборе этого варианта вам будет предложено сразу зарезервировать статический публичный адрес, который будет сохраняться за вашим облаком не только всё то время, пока действует созданная вами ВМ, но даже и в случае её удаления. Это позволяет пересоздать ВМ, сохранив за ней тот же публичный адрес. Кроме того, зарезервированный адрес можно будет назначить какой-либо другой вашей ВМ. Если зарезервированный адрес вам больше не нужен, не забудьте прекратить его резервирование, т.к. пользование публичными адресами платное.

   - ВМ **без публичного адреса** не подходит для запуска веб-сайта. Без публичного адреса к машине нельзя подключиться из интернета, хотя можно подключаться с других ВМ вашего облака.

   Сетевые настройки виртуальной машины при необходимости можно изменить позже.

1. Укажите данные для доступа на виртуальную машину:

   - В поле **Логин** введите имя пользователя.
   - В поле **SSH-ключ** вставьте содержимое файла открытого ключа.

     Пару ключей для подключения по SSH необходимо создать самостоятельно, см. [раздел о подключении к виртуальным машинам по SSH](../../compute/operations/vm-connect/ssh.md).

1. Нажмите кнопку **Создать ВМ**.

   Создание виртуальной машины может занять несколько минут. Когда виртуальная машина перейдет в статус `RUNNING`, [подключитесь к ней по SSH](../../compute/operations/vm-connect/ssh.md). Это потребуется для выполнения последующих шагов по переносу и настройке вашего сайта.

   ![vm-running](../../_assets/solutions/lamp-lemp/vm-running.png)

{% include [export-wp-data](../_solutions_includes/wp-migration-export.md) %}

{% include [import-wp-data](../_solutions_includes/wp-migration-import.md) %}

{% include [import-wp-setup](../_solutions_includes/wp-migration-setup.md) %}

## Как удалить созданные ресурсы {#clear-out}

Чтобы перестать платить за сервер в {{ yandex-cloud }}, созданную вами виртуальную машину (`wordpress-vm`) нужно [удалить](../../compute/operations/vm-control/vm-delete.md).

Если вы зарезервировали статический публичный IP-адрес для этой ВМ:

1. Откройте сервис **Virtual Private Cloud** в вашем каталоге.
1. Перейдите на вкладку **IP-адреса**.
1. Найдите нужный адрес, нажмите значок ![ellipsis](../../_assets/options.svg) и выберите пункт **Удалить**.

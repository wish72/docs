## Настройте веб-сервер {#import-wp-setup}

{% note info %}

В примерах далее для редактирования файлов на виртуальной машине используется простой текстовый редактор `nano`. Чтобы записать на диск сделанные в редакторе изменения, нажмите `^O` и `Enter`. Чтобы выйти из редактора, нажмите `^X`.

{% endnote %}

Настройте веб-сервер Apache, для чего отредактируйте файл конфигурации сайта по образцу ниже.

```bash
sudo nano /etc/apache2/sites-available/000-default.conf
```

Образец файла конфигурации сайта:

```
<VirtualHost *:80 [::]:80>

        ServerAdmin webmaster@localhost

        ServerName u1389147.trial.reg.site
        ServerAlias www.u1389147.trial.reg.site

        # DocumentRoot /var/www/html
        DocumentRoot /var/www/u1389147.trial.reg.site

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        RewriteEngine On

        <Directory /var/www/u1389147.trial.reg.site/>
            RewriteBase /
            RewriteRule ^index\.php$ - [L]
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule . /index.php [L]
        </Directory>

</VirtualHost>
```
В этом образце:
- `u1389147.trial.reg.site` - основное доменное имя сайта
- `www.u1389147.trial.reg.site` - дополнительное доменное имя сайта
- `/var/www/u1389147.trial.reg.site` - путь к каталогу файлов сайта
- символом решётки `#` начинается комментарий
- строки, начинающиеся с `Rewrite`, необходимы для работы WordPress

После редактирования перезагрузите конфигурацию веб-сервера Apache:

```bash
sudo systemctl reload apache2
```

## Проверьте работу сайта {#test-site}

Чтобы проверить работу настроенного вами веб-сайта, нужно направить обращения по его доменному имени к публичному IP-адресу вашей виртуальной машины. Публичный адрес можно уточнить в консоли управления {{ yandex-cloud }} на странице виртуальной машины.


{% note alert %}

Если Вы попытаетесь обратиться к сайту WordPress по IP-адресу виртуальной машины или по доменному имени, которое не соответствует имени, сохранённому в настройках сайта, WordPress перенаправит ваш браузер к доменному имени, сохранённому в настройках сайта. Поэтому обращаться к сайту WordPress следует _по тому доменному имени, которое хранится в его настройках_.

{% endnote %}

Можно направить обращения на новый сайт _отдельно для того компьютера_, с которого вы будете делать проверку, изменив файл `hosts` на этом компьютере.

Изменение файла `hosts` позволяет начать проверку нового сайта немедленно, в то время как вступление в силу [настроек DNS](#configure-dns), в результате которых _все обращения_ будут направлены к новому сайту, может занять значительное время, от нескольких минут до часа и более.

{% list tabs %}

- Linux/macOS

   1. Откройте программу Терминал.

   1. От имени администратора откройте для редактирования файл `/etc/hosts`:

      ```
      sudo nano /etc/hosts
      ```

   1. Добавьте в файл строчку по следующему образцу:

      {% include [wp-migration-hosts](../_solutions_includes/wp-migration-hosts.md) %}

   1. Сохраните и закройте файл.

   1. Убедитесь, что ваши изменения вступили в силу, выполнив команду:

      {% include [wp-migration-ping](../_solutions_includes/wp-migration-ping.md) %}


- Windows 7/8/10

  1. Найдите в меню `Пуск` иконку `Командная строка` (в Windows 10 она по умолчанию находится в группе `Служебные` - `Windows`) и нажмите на ней правой кнопкой мыши.
  1. В открывшемся меню выберите пункт `Запуск от имени администратора`.
  1. Выполните команду:

     ```
     notepad c:\windows\system32\drivers\etc\hosts
     ```

     где:
     - `c:\windows` - папка, в которой установлена система Windows

   1. Добавьте в файл строчку по следующему образцу:

      {% include [wp-migration-hosts](../_solutions_includes/wp-migration-hosts.md) %}

   1. Выберите в меню пункты `Файл`, `Выход` и нажмите `Сохранить`, чтобы записать обновлённый файл на диск.

   1. Выполните следующую команду, чтобы очистить кэш соответствий между доменными именами и IP-адресами:

      ```
      ipconfig /flushdns
      ```

   1. Убедитесь, что ваши изменения вступили в силу, выполнив команду:

      {% include [wp-migration-ping](../_solutions_includes/wp-migration-ping.md) %}

{% endlist %}

После этого откройте ваш новый сайт в браузере и проверьте, правильно ли открываются основные страницы, работают ли все важные функции сайта и прочее.

Убедившись, что новый сайт работает правильно, снова откройте файл `hosts`, как показано выше, и удалите или закомментируйте ранее добавленную вами строчку.

{% note info %}

Помните, что, если другие пользователи могут обращаться к вашему старому сайту, пока вы проверяете работу нового, на старом сайте могут появиться какие-либо изменения, и в результате может потребоваться перенести сайт повторно.

{% endnote %}

## Настройте DNS {#configure-dns}

После того, как новый сайт проверен, нужно внести изменения в DNS, чтобы направить _к новому сайту_ все обращения по его доменному имени.

{% include [configure-a-record-and-cname](../_solutions_includes/configure-a-record-and-cname.md) %}

{% include [wp-migration-setup-https](../_solutions_includes/wp-migration-setup-https.md) %}

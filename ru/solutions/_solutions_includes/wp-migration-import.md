## Импортируйте сайт на виртуальную машину {#import-wp-data}

### Скопируйте файлы экспорта на виртуальную машину {#import-wp-copy}

Существует много разных способов скопировать файлы экспорта на новый сервер. Выбор наиболее подходящего варианта зависит от операционной системы на компьютере, с которого вы управляете виртуальной машиной и куда ранее скачали файлы экспорта существующего сайта, и от ваших личных предпочтений.

Предварительно убедитесь, что подключение к виртуальной машине у вас настроено и действует. Смотрите раздел о том, [как подключиться к виртуальной машине по SSH](https://cloud.yandex.ru/docs/compute/operations/vm-connect/ssh).

{% list tabs %}

- Linux/macOS

   1. Откройте программу Терминал.

   1. Перейдите в каталог, куда вы ранее скачали файлы экспорта существующего сервера:

      ```
      cd \home\ant\Downloads
      ```
   1. Скопируйте файл дампа базы данных сайта на виртуальную машину:

      ```
      scp u1389147_default.sql ant@84.201.156.217:/tmp/
      ```

      {% include [wp-migration-import-scp](../_solutions_includes/wp-migration-import-scp.md) %}

   1. Скопируйте архив файлов сайта на виртуальную машину:

       ```powershell
       scp my-site.tgz ant@84.201.156.217:/tmp/
       ```
       В примере выше:
       - `my-site.tgz` - имя файла архива


- Windows 7/8/10

   Мы покажем один из вариантов с использованием командной строки и приложения PuTTY.

   1. На компьютере, куда вы скачали файлы экспорта, откройте командную строку: `cmd` или `powershell`.

   1. Убедитесь, что программа для копирования файлов через SSH `pscp` доступна:

       ```powershell
       pscp
       ```
     Если вместо приветственного сообщения программы `pscp` вы увидели сообщение об ошибке, ещё раз проверьте, что подключение у вас настроено. Обратите внимание на указание о том, чтобы каталог, куда вы установили PuTTY, присутствовал в `PATH`.

   1. Перейдите в каталог, куда вы ранее скачали файлы экспорта существующего сервера:

      ```powershell
      cd \Users\ant\Downloads
      ```
   1. Скопируйте файл дампа базы данных сайта на виртуальную машину:

      ```powershell
      pscp u1389147_default.sql ant@84.201.156.217:/tmp/
      ```

      {% include [wp-migration-import-scp](../_solutions_includes/wp-migration-import-scp.md) %}

   1. Скопируйте архив файлов сайта на виртуальную машину:

       ```powershell
       pscp my-site.tgz ant@84.201.156.217:/tmp/
       ```
       В примере выше:
       - `my-site.tgz` - имя файла архива

{% endlist %}

{% note info %}

Каталог `/tmp/` в системе Linux предназначен для временных файлов и очищается автоматически при перезагрузке машины. Если вы _не хотите_, чтобы скопированные вами файлы были удалены при перезагрузке, укажите каталог для временных файлов `/var/tmp/`, который не очищается автоматически, или какой-либо другой каталог по вашему выбору.

{% endnote %}

### Подключитесь к виртуальной машине {#import-wp-connect}

Дальнейшие шаги выполняются в командной строке виртуальной машины. Для их выполнения [подключитесь к виртуальной машине по SSH](https://cloud.yandex.ru/docs/compute/operations/vm-connect/ssh).

{% note tip %}

Настраивая виртуальную машину, пользуйтесь копированием текста при помощи мыши, это очень удобно. Например, в окне программы PuTTY в системе Windows, чтобы выделить слово, щёлкните на слове левой кнопкой мыши дважды (или щёлкните один раз, чтобы начать выделение по одному символу), а затем двигайте мышь, удерживая левую кнопку, и отпустите кнопку, когда выделение нужного текста будет завершено. Щёлкните правой кнопкой мыши, и выделенный текст будет вставлен там, где на экране находится курсор.

{% endnote %}

Убедитесь, что файлы экспорта успешно скопированы на виртуальную машину:

```bash
cd /tmp
ls -l *.tgz *.sql
```

В выведенном на экран списке должны быть скопированные вами файлы экспорта.

### Распакуйте архив файлов сайта {import-wp-fs}

Распакуйте архив файлов сайта в каталоге данных веб-сервера и назначьте владельца файлов и необходимые права доступа к файлам:

```bash
cd /var/www
sudo tar zxvf /tmp/my-site.tgz
cd u1389147.trial.reg.site
sudo chown -R www-data.www-data .
sudo chmod 600 wp-config.php
```

В примере выше:
- `u1389147.trial.reg.site` - имя каталога, в котором содержатся файлы сайта. Обычно совпадает с именем сайта. Вы узнали его, когда экспортировали файлы сайта на существующем сервере.

### Загрузите дамп базы данных сайта {#import-wp-db}

1. Узнайте имя и пароль пользователя базы данных, которые использовались на существующем сайте. WordPress будет работать с базой данных от имени этого пользователя. Обратите внимание, это _не пользователь операционной системы_. Имя _пользователя_ базы данных и имя базы данных сайта обычно совпадают.

   ```bash
   sudo grep -E 'DB_USER|DB_PASSWORD' wp-config.php
   ```

   Пример вывода команды выше:
   ```
   define( 'DB_USER', 'u1389147_default' );
   define( 'DB_PASSWORD', 'WnV1a2ahJ9nsSm3V' );
   ```

1. Узнайте пароль администратора баз данных на виртуальной машине. Он был автоматически сохранён в файле, находящемся в домашнем каталоге пользователя `root` виртуальной машины:

   ```bash
   sudo cat /root/default_passwords.txt
   ```

   Пример вывода команды выше:
   ```
   MYSQL_ROOT_PASS=LyCq6ca2rPp3Qn
   ```

1. Подключитесь к СУБД как администратор баз данных.

    ```bash
    $ sudo mysql -p
    ```

    В ответ на запрос пароля введите (выделите мышью и вставьте) пароль администратора баз данных, который был выведен на экран на предыдущем шаге.

1. Создайте базу данных сайта.

    ```sql
    mysql> CREATE DATABASE u1389147_default CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
    ```

    В примере выше:
    - `u1389147_default` - имя базы, вы узнали его, когда экспортировали базу данных существующего сайта

1. Создайте пользователя базы данных и предоставьте ему права доступа к только что созданной базе данных:

    ```sql
    mysql> GRANT ALL PRIVILEGES ON u1389147_default.* TO 'u1389147_default'@'localhost' IDENTIFIED BY 'WnV1a2ahJ9nsSm3V';
    ```
    В примере выше:
    - `u1389147_default` - имя базы данных и имя пользователя базы данных, обычно совпадают
    - `WnV1a2ahJ9nsSm3V` - пароль пользователя базы данных сайта, вы узнали его на первом шаге

1. Отключитесь от СУБД, нажав `^D`.

1. Загрузите дамп базы данных сайта.

    ```bash
    mysql -u u1389147_default -p u1389147_default < /tmp/u1389147_default.sql
    ```

    В примере выше:
    - `u1389147_default` - имя пользователя базы данных и имя базы данных
    - `/tmp/u1389147_default.sql` - путь к файлу дампа базы данных сайта

    В ответ на запрос пароля введите пароль пользователя базы данных сайта. Загрузка базы займёт некоторое время.
